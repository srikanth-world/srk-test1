Sub ApplyConditionalFormattingToAllSheets3()
    Dim ws As Worksheet
    Dim formula As String
    formula = "=$A:$W"
    
    For Each ws In ThisWorkbook.Sheets
        Dim headerCell As Range
        Set headerCell = ws.Cells(2, 1)
        
        Do While headerCell.Value <> ""
            Dim rng As Range
            Set rng = ws.Range(headerCell, headerCell.Offset(1, 0))
            
            rng.FormatConditions.Add Type:=xlUniqueValues
            With rng.FormatConditions(rng.FormatConditions.Count)
                .Interior.Color = RGB(172, 185, 130)
                .Font.Color = RGB(0, 0, 0)
            End With
            
            headerCell.FormatConditions.Add Type:=xlUniqueValues
            With headerCell.FormatConditions(headerCell.FormatConditions.Count)
                .Interior.Color = RGB(172, 185, 130)
                .Font.Color = RGB(0, 0, 0)
            End With
            
            ' Move to the next header cell
            Set headerCell = headerCell.Offset(0, 1)
        Loop
    Next ws
End Sub
